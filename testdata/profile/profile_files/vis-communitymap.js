var RYMcommunityMapVis={width:500,height:333,updateNightView:function(e,t){var a=$("#"+e);a.length!=0&&(a[0].className="musicmap svg-container-55 night")},create:function(e){RYMcommunityMapVis.projection=d3.geo.mercator().translate([0,0]).scale(RYMcommunityMapVis.width/2/Math.PI),RYMcommunityMapVis.zoom=d3.behavior.zoom().scaleExtent([1,318]),RYMcommunityMapVis.path=d3.geo.path().projection(RYMcommunityMapVis.projection),RYMcommunityMapVis.updateNightView(e,!1),RYMcommunityMapVis.svg=d3.select("#"+e).classed("svg-container-55",!0).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 500 333").classed("svg-content-responsive",!0).append("g").attr("transform","translate("+RYMcommunityMapVis.width/2+","+RYMcommunityMapVis.height/2+")").call(RYMcommunityMapVis.zoom),RYMcommunityMapVis.g=RYMcommunityMapVis.svg.append("g").on("zoom",null),RYMcommunityMapVis.svg.append("rect").attr("class","overlay").attr("x",-RYMcommunityMapVis.width/2).attr("y",-RYMcommunityMapVis.height/2).attr("width",RYMcommunityMapVis.width).attr("height",RYMcommunityMapVis.height),d3.json("https://e.snmc.io/3.0/geo/world-topo.json",function(t,a){if(t)throw t;RYMcommunityMapVis.g.append("path").datum(topojson.feature(a,a.objects.countries)).attr("class","land").attr("d",RYMcommunityMapVis.path),RYMcommunityMapVis.g.append("path").datum(topojson.mesh(a,a.objects.countries,function(n,o){return n!==o})).attr("class","boundary").attr("d",RYMcommunityMapVis.path).style("stroke-width",.5),RYMcommunityMapVis.drawCircles()}),RYMcommunityMapVis.cities=RYMcommunityMapVis.getCities(mapLocations.artists)},move:function(e,t){e[0]=Math.min(RYMcommunityMapVis.width/2*(t-1),Math.max(RYMcommunityMapVis.width/2*(1-t),e[0])),e[1]=Math.min(RYMcommunityMapVis.height/2*(t-1)+RYMcommunityMapVis.height/2*t,Math.max(RYMcommunityMapVis.height/2*(1-t)-RYMcommunityMapVis.height/2*t,e[1])),RYMcommunityMapVis.zoom.translate(e),RYMcommunityMapVis.g.attr("transform","translate("+e+")scale("+t+")"),RYMcommunityMapVis.svg.selectAll("path").attr("d",RYMcommunityMapVis.path).style("stroke-width",Math.min(.5,.5/t)),RYMcommunityMapVis.svg.selectAll("circle").style("opacity",function(a){return RYMcommunityMapVis.getOpacity(a)}).attr("r",function(a){return Math.min(2,5/t)}).attr("cx",function(a){return RYMcommunityMapVis.projection([a.lo,a.la])[0]}).attr("cy",function(a){return RYMcommunityMapVis.projection([a.lo,a.la])[1]}).attr("transform","translate("+e+")scale("+t+")")},zoomCircles:function(){var e=99999999,t=-99999999,a=99999999,n=-99999999;RYMcommunityMapVis.svg.selectAll("circle").style("opacity",function(r){return RYMcommunityMapVis.getOpacity(r)}).attr("cx",function(r){if(RYMcommunityMapVis.getOpacity(r)>0){var i=RYMcommunityMapVis.projection([r.lo,r.la])[0];return e=Math.min(i,e),t=Math.max(i,t),i}return 0}).attr("cy",function(r){if(RYMcommunityMapVis.getOpacity(r)>0){var i=RYMcommunityMapVis.projection([r.lo,r.la])[1];return a=Math.min(i,a),n=Math.max(i,n),i}return 0});var o=t-e,l=n-a,s=(t+e)/2,h=(n+a)/2,c=.8/Math.max(o/RYMcommunityMapVis.width,l/RYMcommunityMapVis.height),u=[RYMcommunityMapVis.width/2-c*s,RYMcommunityMapVis.height/2-c*h];RYMcommunityMapVis.move(u,c)},drawCircles:function(){RYMcommunityMapVis.circles=RYMcommunityMapVis.svg.selectAll("circle");var e=99999999,t=-99999999,a=99999999,n=-99999999;RYMcommunityMapVis.circles.data(RYMcommunityMapVis.cities,function(r,i){return"artist"+i}).enter().append("circle").attr("d",RYMcommunityMapVis.path).style("opacity",function(r){return RYMcommunityMapVis.getOpacity(r)}).attr("r",function(r){return 3}).style("fill",function(r){return"#fff"}).attr("cx",function(r){if(RYMcommunityMapVis.getOpacity(r)){var i=RYMcommunityMapVis.projection([r.lo,r.la])[0];return e=Math.min(i,e),t=Math.max(i,t),i}return 0}).attr("cy",function(r){if(RYMcommunityMapVis.getOpacity(r)){var i=RYMcommunityMapVis.projection([r.lo,r.la])[1];return a=Math.min(i,a),n=Math.max(i,n),i}return 0});var o=t-e,l=n-a,s=(t-e)/2,h=(n-a)/2,c=.8/Math.max(o/RYMcommunityMapVis.width,l/RYMcommunityMapVis.height),u=[RYMcommunityMapVis.width/2-c*s,RYMcommunityMapVis.height/2-c*h]},getOpacity:function(e){var t=!1;if(RYMcommunityMapVis.filter)switch(RYMcommunityMapVis.filter.field){case"continent":e.continent_id===RYMcommunityMapVis.filter.id&&(t=!0);break;case"country":e.country_id===RYMcommunityMapVis.filter.id&&(t=!0);break;case"region":e.region_id===RYMcommunityMapVis.filter.id&&(t=!0);break}else return .45;return t?.8:0},setFilter:function(e,t){RYMcommunityMapVis.filter={field:e,id:t},RYMcommunityMapVis.svg.selectAll("circle").transition().duration(500).style("opacity",function(a){return RYMcommunityMapVis.getOpacity(a)})},clearFilter:function(){RYMcommunityMapVis.filter=null,RYMcommunityMapVis.svg.selectAll("circle").transition().duration(500).style("opacity",function(e){return RYMcommunityMapVis.getOpacity(e)})},getCities:function(e){var t=new Array;for(var a in e){var n=e[a];t.push(n)}return t}};
